resource "scm_vulnerability_protection_profile" "scm_vp_profile_1_test" {
  folder      = "Shared"
  name        = "vp-profile-1-test"
  description = "basic profile"
}

resource "scm_vulnerability_protection_profile" "scm_vp_profile_2_test" {
  folder      = "Shared"
  name        = "vp-profile-2-test"
  description = "rules: allow, alert, and drop"

  rules = [
    {
      name = "Rule-Informational-Allow"
      action = {
        allow = {}
      }
      packet_capture = "extended-capture"
      severity       = ["informational"]
      category       = "scan"
      cve            = ["N/A"]
      host           = "client"
      vendor_id      = ["Match Any Vendor"]
      threat_name    = "30000"
    },
    {
      name = "Rule-Medium-Alert"
      action = {
        alert = {}
      }
      packet_capture = "single-packet"
      severity       = ["medium"]
      category       = "info-leak"
      cve            = ["Match Any CVE"]
      host           = "server"
      vendor_id      = ["MS08-037"]
      threat_name    = "OpenSSL Threat"
    },
    {
      name = "Rule-Critical-High-Drop"
      action = {
        drop = {}
      }
      packet_capture = "disable"
      severity       = ["critical", "high"]
      category       = "overflow"
      cve            = ["CVE-2008-1147"]
      host           = "any"
      vendor_id      = ["Match Any Vendor"]
      threat_name    = "any"
    }
  ]
}

resource "scm_vulnerability_protection_profile" "scm_vp_profile_3_test" {
  folder      = "Shared"
  name        = "vp-profile-3-test"
  description = "rules: reset client, reset server, reset both"
  rules = [
    {
      name = "Rule-Low-Reset_Client"
      action = {
        reset_client = {}
      }
      severity    = ["low"]
      category    = "protocol-anomaly"
      cve         = ["CVE-2010-3332", "CVE-2019-14537"]
      host        = "client"
      vendor_id   = ["MSO5-032", "IZ18434"]
      threat_name = "30261"
    },
    {
      name = "Rule-Info-Low-Reset_Server"
      action = {
        reset_server = {}
      }
      packet_capture = "disable"
      severity       = ["informational", "low"]
      category       = "insecure-credentials"
      cve            = ["N/A"]
      host           = "server"
      vendor_id      = ["Match Any Vendor"]
      threat_name    = "Zone Bypass"
    },
    {
      name = "Rule-Medium-Reset_Both"
      action = {
        reset_both = {}
      }
      packet_capture = "single-packet"
      severity       = ["medium"]
      category       = "brute-force"
      cve            = ["CVE-2012-0175", "CVE-2024-6387", "CVE-2017-14473"]
      host           = "any"
      vendor_id      = ["CORE-1009-0227", "SHIRO-550", "AST-2012-008"]
      threat_name    = "any"
    }
  ]
}

resource "scm_vulnerability_protection_profile" "scm_vp_profile_4_test" {
  folder      = "Shared"
  name        = "vp-profile-4-test"
  description = "rules: block ip"

  rules = [
    {
      name = "Rule-High-Critical-Block_IP"
      action = {
        block_ip = {
          duration = 3600
          track_by = "source-and-destination"
        }
      }
      severity    = ["high", "critical"]
      category    = "insecure-credentials"
      cve         = ["N/A"]
      host        = "server"
      vendor_id   = ["Match Any Vendor"]
      threat_name = "Zone Credentials"
    },
    {
      name = "Rule-Low-Medium-Block_IP"
      action = {
        block_ip = {
          duration = 2400
          track_by = "source-and-destination"
        }
      }
      severity    = ["low", "medium"]
      category    = "command-execution"
      cve         = ["N/A"]
      host        = "server"
      vendor_id   = ["Match Any Vendor"]
      threat_name = "any"
    }
  ]
}

resource "scm_vulnerability_protection_profile" "scm_vp_profile_5_test" {
  folder      = "Shared"
  name        = "vp-profile-5-test"
  description = "override"

  threat_exception = [
    {
      name = "12345"
      action = {
        allow = {}
      }
      severity = ["informational"]
      category = "command-execution"
      exempt_ip = [
        { name = "192.14.3.100" },
      ]
      time_attribute = {
        interval  = 3600
        threshold = 24000
        track_by  = "source"
      }
    }
  ]
}

resource "scm_vulnerability_protection_profile" "scm_vp_profile_6_test" {
  folder      = "Shared"
  name        = "vp-profile-6-test"
  description = "mixed"

  rules = [
    {
      name = "Rule-Info-Rest_Both"
      action = {
        allow = {}
      }
      # NOTE: Changed "disabled" to "disable" to match other resources (if "disable" is the correct value)
      packet_capture = "disable"
      severity       = ["informational"]
      category       = "exploit-kit"
      cve            = ["N/A"]
      host           = "client"
      vendor_id      = ["Match Any Vendor"]
      threat_name    = "30000"
    },
    {
      name = "Rule-Low-Alert"
      action = {
        alert = {}
      }
      packet_capture = "single-packet"
      severity       = ["low"]
      category       = "dos"
      cve            = ["CVE-2020-8790"]
      host           = "server"
      vendor_id      = ["MS09-036"]
      threat_name    = "Memory Corruption"
    },
    {
      name = "Rule-Medium-Drop"
      action = {
        drop = {}
      }
      packet_capture = "disable"
      severity       = ["medium", "high"]
      category       = "insecure-credentials"
      cve            = ["N/A"]
      host           = "any"
      vendor_id      = ["Match Any Vendor"]
      threat_name    = "any"
    }
  ]
  threat_exception = [
    {
      name = "12345"
      action = {
        drop = {}
      }
      packet_capture = "single-packet"
      host           = "any"
      category       = "scan"
      cve            = ["CVE-2011-2663", "CVE-2016-9949"]
      exempt_ip = [
        { name = "192.14.3.100" },
      ]
    }
  ]
}